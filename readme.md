# mika 游戏及游戏库

这里是名为mika的游戏及游戏库，游戏使用python语言编写，目前还没有开始开发本体。

游戏库实现了类curses的字符界面显示，后端采用python写成，使用Pyodide运行在浏览器中。

游戏库提供了一种类tex语法的标记语言，可以方便地描述字符风格、动画、位置等内容。

```plaintext
\tick[:0.1]Behold\delay[:0.5], here I am!\delay[:1.0]
The {\s[bg=gray]Most {\s[fg=gold]\tick[:0.4]ALMIGHTY} and {\s[fg=red]\tick[:0.4]POWERFUL}}
{\s[bg=red]Dragon} in this Kingdom!
```

## TODO

- [x] 地图显示系统
  - 采用选项的方式实现，其实就是对话系统！
  - 地图包括许多场景，每个场景代表一个地点。
  - 每个场景有场景描述。从每个场景，可以去往其他场景（有去其他场景的选项），还可以和场景中的人物对话（也是选项）
  - 人物对话时，场景不能操作，需要到对话结束后方可操作。
  - 每个人物都有一个id，在地图场景的\ts命令，设置一个参数，是dialogue，该参数比to参数优先，触发人物对话
  - 在人物对话触发后，地图会重新渲染，此时，/st参数中的character_dialogue_m会被设成True，否则被设成False
- [x] 场景存储文件
  - 存储场景间的连接关系（从这个场景可以到达什么场景）
  - 存储场景的描述（该场景需要显示的文字）
  - 存储场景中的人物
  - 以yaml格式存储，~~连接关系是列表~~
- [x] 通过场景存储文件生成场景对象，再生成场景的styleml sentence
- [x] 人物和场景存储目录结构
  - 人物和场景存储，需要有命名空间，各层目录用"."隔开
  - 人物直接存储其对话
- [x] 全局宏
  - 将人物的宏加上命名空间，人物自己读取宏的时候，可以省略掉命名空间。这样就可以读取其他人物设置的宏了
- [ ] 调用外部函数
  - 人物和地图都可以加调用外部函数的宏，由各自的dialogue类管理。外部函数可以有参数
- [x] 自定义字符类型
  - 自定义字符弄一个命令，命令参数包括自定义字符类型和参数，具体渲染成什么，由渲染器来实现
- [ ] 半角字符
  - 一个格子中可以放2个半角字符，采用自定义字符来实现。再实现自动转换成半角字符的命令
- [ ] 人物头像及表情
  - 加入一个特定的绝对坐标引用，表示放头像的地方，然后头像直接使用行内的重定位显示，就不需要写单独的功能了。
- [ ] 区域性dialogue
  - 将屏幕分为若干个区域，每个sentence指定要输出到的区域
  - 使用模块化的yaml存储对话，编译到styleml，对话内容仍然使用styleml书写
  - 使用yaml的存储方式，可以调用一些模板（比如「选项」模板、对话次数模板、跳转模板等）
- [ ] 书写系统的互相引用
  - 每一种书写系统（glyphset）（至少包括组字的）实现一个渲染到格子的方式（包括默认的）。\g命令的参数先使用styleml parser解析一遍，再使用书写系统渲染器来渲染。
